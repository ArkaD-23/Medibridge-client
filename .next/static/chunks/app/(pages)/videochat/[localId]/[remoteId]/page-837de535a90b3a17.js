(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[345],{8735:(e,t,r)=>{Promise.resolve().then(r.bind(r,9612))},9420:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});let o=(0,r(9946).A)("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]])},9612:(e,t,r)=>{"use strict";r.d(t,{default:()=>f});var o=r(5155),n=r(2115),i=r(7287),a=r(112),l=r(6707),s=r(9946);let c=(0,s.A)("mic",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]]),d=(0,s.A)("mic-off",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]]),u=(0,s.A)("video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]),p=(0,s.A)("video-off",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);var h=r(9420),g=r(4589),v=r(3811),y=r.n(v);function f(e){let{localId:t,remoteId:r}=e,[s,v]=(0,n.useState)(!0),[f,x]=(0,n.useState)(!0),b=(0,n.useRef)(null),w=(0,n.useRef)(null),m=(0,n.useRef)(null),k=(0,n.useRef)(null);(0,n.useEffect)(()=>{console.log("\uD83D\uDCE1 Initializing PeerConnection for",t,"->",r),m.current=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),m.current.ontrack=e=>{console.log("\uD83C\uDFA5 Remote track received:",e.streams),w.current&&(w.current.srcObject=e.streams[0])},m.current.onicecandidate=e=>{e.candidate&&k.current&&(console.log("❄️ Sending ICE candidate:",e.candidate),k.current.publish({destination:"/app/webrtc.ice",body:JSON.stringify({type:"ICE",senderId:t,recipientId:r,data:e.candidate})}))},navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(e=>{console.log("\uD83D\uDCF7 Local stream captured:",e),b.current&&(b.current.srcObject=e),e.getTracks().forEach(t=>{var r;console.log("➕ Adding local track:",t.kind),null==(r=m.current)||r.addTrack(t,e)})}).catch(e=>{console.error("\uD83D\uDEA8 Error accessing media devices:",e)});let e=new g.K({webSocketFactory:()=>new(y())("http://localhost:8082/ws-chat"),reconnectDelay:5e3});return e.onConnect=()=>{console.log("\uD83D\uDD0C STOMP connected"),e.subscribe("/topic/webrtc.".concat(t),r=>{var o,n,i;let a=JSON.parse(r.body);console.log("\uD83D\uDCE9 Received signaling message:",a),"OFFER"===a.type?(console.log("\uD83D\uDCE8 Processing OFFER from",a.senderId),null==(o=m.current)||o.setRemoteDescription(new RTCSessionDescription(a.data)).then(()=>{var e;return null==(e=m.current)?void 0:e.createAnswer()}).then(r=>{var o;console.log("\uD83D\uDCE4 Sending ANSWER"),null==(o=m.current)||o.setLocalDescription(r),e.publish({destination:"/app/webrtc.answer",body:JSON.stringify({type:"ANSWER",senderId:t,recipientId:a.senderId,data:r})})})):"ANSWER"===a.type?(console.log("\uD83D\uDCE8 Processing ANSWER"),null==(n=m.current)||n.setRemoteDescription(new RTCSessionDescription(a.data))):"ICE"===a.type&&(console.log("\uD83D\uDCE8 Adding remote ICE candidate:",a.data),null==(i=m.current)||i.addIceCandidate(new RTCIceCandidate(a.data)))})},e.onStompError=e=>{console.error("\uD83D\uDEA8 STOMP error:",e.headers.message,e.body)},e.activate(),k.current=e,()=>{var t;console.log("\uD83D\uDED1 Cleaning up peer connection and STOMP"),e.deactivate(),null==(t=m.current)||t.close()}},[t,r]);let C=async()=>{if(!m.current||!k.current)return void console.warn("⚠️ Cannot start call, connection not ready");console.log("\uD83D\uDCDE Creating OFFER...");let e=await m.current.createOffer();await m.current.setLocalDescription(e),console.log("\uD83D\uDCE4 Sending OFFER to",r,e),k.current.publish({destination:"/app/webrtc.offer",body:JSON.stringify({type:"OFFER",senderId:t,recipientId:r,data:e})})};return(0,o.jsx)("div",{style:{backgroundColor:"#f9fafb",minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto"},children:(0,o.jsxs)(i.t,{shadow:"lg",radius:"md",p:"md",style:{width:"90%",maxWidth:"900px",height:"80vh",display:"flex",flexDirection:"column",justifyContent:"space-between",position:"relative",overflow:"hidden"},children:[(0,o.jsxs)("div",{style:{flex:1,backgroundColor:"#000",borderRadius:"8px",position:"relative",height:"80%"},children:[(0,o.jsx)("video",{ref:w,autoPlay:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"8px"}}),(0,o.jsx)("div",{style:{position:"absolute",bottom:"10px",left:"10px",backgroundColor:"rgba(0,0,0,0.6)",color:"white",padding:"4px 8px",borderRadius:"6px",fontSize:"14px"},children:"Dr. Smith"})]}),(0,o.jsxs)("div",{style:{position:"absolute",bottom:"80px",right:"20px",width:"200px",height:"150px",borderRadius:"8px",overflow:"hidden",border:"2px solid white"},children:[(0,o.jsx)("video",{ref:b,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",height:"100%",objectFit:"cover",overflow:"hidden"}}),(0,o.jsx)("div",{style:{position:"absolute",bottom:"5px",left:"5px",backgroundColor:"rgba(0,0,0,0.6)",color:"white",padding:"2px 6px",borderRadius:"4px",fontSize:"12px"},children:"You"})]}),(0,o.jsxs)(a.Y,{position:"center",spacing:"lg",mt:"md",children:[(0,o.jsx)(l.$,{radius:"xl",size:"lg",color:s?"#1e40af":"gray",onClick:()=>{var e;v(!s);let t=null==(e=b.current)?void 0:e.srcObject;null==t||t.getAudioTracks().forEach(e=>e.enabled=!e.enabled),console.log("\uD83C\uDF99️ Mic toggled:",!s)},children:s?(0,o.jsx)(c,{size:20}):(0,o.jsx)(d,{size:20})}),(0,o.jsx)(l.$,{radius:"xl",size:"lg",color:f?"#1e40af":"gray",onClick:()=>{var e;x(!f);let t=null==(e=b.current)?void 0:e.srcObject;null==t||t.getVideoTracks().forEach(e=>e.enabled=!e.enabled),console.log("\uD83D\uDCF9 Video toggled:",!f)},children:f?(0,o.jsx)(u,{size:20}):(0,o.jsx)(p,{size:20})}),(0,o.jsx)(l.$,{radius:"xl",size:"lg",color:"green",onClick:C,children:(0,o.jsx)(h.A,{size:20})})]})]})})}},9946:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var o=r(2115);let n=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},i=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,o.forwardRef)((e,t)=>{let{color:r="currentColor",size:n=24,strokeWidth:l=2,absoluteStrokeWidth:s,className:c="",children:d,iconNode:u,...p}=e;return(0,o.createElement)("svg",{ref:t,...a,width:n,height:n,stroke:r,strokeWidth:s?24*Number(l)/Number(n):l,className:i("lucide",c),...!d&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(p)&&{"aria-hidden":"true"},...p},[...u.map(e=>{let[t,r]=e;return(0,o.createElement)(t,r)}),...Array.isArray(d)?d:[d]])}),s=(e,t)=>{let r=(0,o.forwardRef)((r,a)=>{let{className:s,...c}=r;return(0,o.createElement)(l,{ref:a,iconNode:t,className:i("lucide-".concat(n(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),s),...c})});return r.displayName=n(e),r}}},e=>{e.O(0,[21,614,441,964,358],()=>e(e.s=8735)),_N_E=e.O()}]);