(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[36],{2623:(e,t,n)=>{"use strict";n.d(t,{default:()=>o});var s=n(5155),a=n(2115),r=n(5695),l=n(3347);function o(e){let{children:t}=e,n=(0,r.useRouter)(),[o,i]=(0,a.useState)(!0),[c,d]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{localStorage.getItem("token")?d(!0):n.replace("/signin"),i(!1)},[n]),o)?(0,s.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,s.jsx)(l.a,{size:"lg",color:"#1e40af"})}):c?(0,s.jsx)(s.Fragment,{children:t}):null}},5695:(e,t,n)=>{"use strict";var s=n(8999);n.o(s,"useRouter")&&n.d(t,{useRouter:function(){return s.useRouter}})},6134:(e,t,n)=>{"use strict";n.d(t,{default:()=>x});var s=n(5155),a=n(2115),r=n(7287),l=n(6568),o=n(8887),i=n(112),c=n(8593),d=n(6707),u=n(3811),h=n.n(u),p=n(4589);function x(e){let{senderId:t,recipientId:n}=e,[u,x]=(0,a.useState)([]),[f,m]=(0,a.useState)(""),[g,y]=(0,a.useState)(null);return(0,a.useEffect)(()=>{let e=new p.K({webSocketFactory:()=>new(h())("http://localhost:8082/ws-chat"),reconnectDelay:5e3});return e.onConnect=async()=>{console.log("Connected to WebSocket");let s=await fetch("http://gateway:8090/v1/chat/messages/".concat(t,"/").concat(n));x(await s.json()),e.subscribe("/topic/messages/".concat(t),e=>{console.log("\uD83D\uDCE9 Incoming raw:",e.body);let t=JSON.parse(e.body);x(e=>[...e,t])})},console.log("messages: ",u),e.activate(),y(e),()=>e.deactivate()},[]),(0,s.jsx)("div",{style:{backgroundColor:"#f9fafb",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,s.jsxs)(r.t,{shadow:"md",p:"md",style:{width:600,height:"100vh",display:"flex",flexDirection:"column"},children:[(0,s.jsx)(l.F,{style:{flex:1,marginBottom:"10px"},children:(0,s.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:Array.isArray(u)?u.map((e,n)=>(0,s.jsx)("div",{style:{alignSelf:e.senderId===t?"flex-end":"flex-start",backgroundColor:e.senderId===t?"#1e40af":"#e5e7eb",color:e.senderId===t?"white":"black",padding:"8px 12px",borderRadius:12,maxWidth:"70%"},children:(0,s.jsx)(o.E,{size:"sm",children:e.content})},n)):null})}),(0,s.jsxs)(i.Y,{children:[(0,s.jsx)(c.k,{placeholder:"Type a message...",value:f,onChange:e=>m(e.currentTarget.value),style:{flex:1}}),(0,s.jsx)(d.$,{onClick:()=>{if(!f.trim()||!g)return;let e={senderId:t,recipientId:n,content:f,type:"TEXT",ts:Date.now()};g.publish({destination:"/app/chat.send",body:JSON.stringify(e)}),console.log("\uD83D\uDCE4 Sent:",e),m("")},color:"#1e40af",children:"Send"})]})]})})}},7606:(e,t,n)=>{Promise.resolve().then(n.bind(n,6134)),Promise.resolve().then(n.bind(n,2623))},8593:(e,t,n)=>{"use strict";n.d(t,{k:()=>o});var s=n(5155);n(2115);var a=n(3664),r=n(6960),l=n(8470);let o=(0,r.P9)((e,t)=>{let n=(0,a.Y)("TextInput",null,e);return(0,s.jsx)(l.O,{component:"input",ref:t,...n,__staticSelector:"TextInput"})});o.classes=l.O.classes,o.displayName="@mantine/core/TextInput"},8887:(e,t,n)=>{"use strict";n.d(t,{E:()=>f});var s=n(5155);n(2115);var a=n(6204),r=n(8918),l=n(1180),o=n(8512),i=n(3664),c=n(862),d=n(311),u=n(4511),h={root:"m_b6d8b162"};let p={inherit:!1},x=(0,r.V)((e,t)=>{let{variant:n,lineClamp:s,gradient:r,size:i,color:c}=t;return{root:{"--text-fz":(0,a.ny)(i),"--text-lh":(0,a.ks)(i),"--text-gradient":"gradient"===n?(0,o.v)(r,e):void 0,"--text-line-clamp":"number"==typeof s?s.toString():void 0,"--text-color":c?(0,l.r)(c,e):void 0}}}),f=(0,u.v)((e,t)=>{let n=(0,i.Y)("Text",p,e),{lineClamp:a,truncate:r,inline:l,inherit:o,gradient:u,span:f,__staticSelector:m,vars:g,className:y,style:v,classNames:b,styles:j,unstyled:S,variant:k,mod:w,size:I,attributes:C,...T}=n,_=(0,c.I)({name:["Text",m],props:n,classes:h,className:y,style:v,classNames:b,styles:j,unstyled:S,attributes:C,vars:g,varsResolver:x});return(0,s.jsx)(d.a,{..._("root",{focusable:!0}),ref:t,component:f?"span":"p",variant:k,mod:[{"data-truncate":function(e){return"start"===e?"start":"end"===e||e?"end":void 0}(r),"data-line-clamp":"number"==typeof a,"data-inline":l,"data-inherit":o},w],size:I,...T})});f.classes=h,f.displayName="@mantine/core/Text"}},e=>{e.O(0,[545,21,563,470,614,441,964,358],()=>e(e.s=7606)),_N_E=e.O()}]);